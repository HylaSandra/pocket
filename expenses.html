<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Pocket – Wydatki</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <h1>Wydatki</h1>
  <nav>
    <a href="index.html">Dodaj transakcję</a> |
    <a href="expenses.html">Wydatki</a> |
    <a href="income.html">Przychody</a> |
    <a href="budget.html">Budżet</a>
  </nav>

  <div id="date-filters">
    <label>Od: <input type="date" id="start-date" /></label>
    <label>Do: <input type="date" id="end-date" /></label>
    <button id="filter-btn">Filtruj</button>
  </div>

  <p id="total-sum">Suma wydatków: 0 zł</p>
  <ul id="transaction-list"></ul>
  <script src="app.js"></script>
  <script>
    const API_BASE = 'https://pocket-be-xt4u.onrender.com/api';
    const list = document.getElementById('transaction-list');
    const totalSum = document.getElementById('total-sum');
    const filterBtn = document.getElementById('filter-btn');
    const startDate = document.getElementById('start-date');
    const endDate = document.getElementById('end-date');
    let txs = [];
    async function loadData() {
      try {
        const res = await fetch(`${API_BASE}/transactions`);
        const data = await res.json();
        txs = data.transactions;
        localStorage.setItem('transactions', JSON.stringify(txs));
      } catch {
        txs = JSON.parse(localStorage.getItem('transactions')||'[]');
      }
      render();
    }
    function filterTx() {
      const s = startDate.value ? new Date(startDate.value) : null;
      const e = endDate.value ? new Date(endDate.value) : null;
      return txs.filter(t => t.amount<0 && (!s||new Date(t.date)>=s) && (!e||new Date(t.date)<=e));
    }
    function render() {
      const arr = filterTx();
      list.innerHTML = arr.length?
        arr.map(t=>`<li>➖ ${Math.abs(t.amount)} zł (${t.category}) [${new Date(t.date).toLocaleDateString()}] <button data-id="${t._id}" class="delete-btn">Usuń</button></li>`).join(''):
        '<li>Brak wydatków w tym okresie.</li>';
      const sum = arr.reduce((a,t)=>a+Math.abs(t.amount),0);
      totalSum.textContent = `Suma wydatków: ${sum.toFixed(2)} zł`;
    }
    async function deleteTx(id) {
      txs = txs.filter(t=>t._id!==id);
      localStorage.setItem('transactions',JSON.stringify(txs));
      render();
      try { await fetch(`${API_BASE}/transactions/${id}`,{method:'DELETE'}); } catch{};
    }
    list.addEventListener('click',e=>{
      if(e.target.classList.contains('delete-btn')){
        deleteTx(e.target.dataset.id);
      }
    });
    filterBtn.addEventListener('click',render);
    loadData();
  </script>
</body>
</html>
